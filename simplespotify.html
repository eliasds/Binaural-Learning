<!DOCTYPE html>
<html>
<head>
	<title>Spotify Web API Example</title>
	<script src="https://unpkg.com/tone"></script> <!-- use this one --> 
	<script src="https://sdk.scdn.co/spotify-player.js"></script>
</head>
<body>
	<h1>Spotify Web API Example v11</h1>

	<button id="connect-button">Connect to Spotify</button>
	<button id="play-button" disabled>Play</button>
	<button id="pause-button" disabled>Pause</button>
	
	<script>
		
    // Spotify Web API credentials
    const CLIENT_ID = 'f1692e4b1b6d44d4bafa58860c5cf9ca';		
    const REDIRECT_URI = 'https://eliasds.github.io/Binaural-Learning/redirect.html';
    const SCOPES = 'user-read-playback-state user-modify-playback-state';

		// Check if the access token is stored in localStorage
		const token = localStorage.getItem('access_token');
		if (token) {
			// Initialize the Spotify Web Playback SDK
			window.onSpotifyWebPlaybackSDKReady = () => {
				console.log('Spotify Web Playback SDK is ready');
				initializePlayer(token);
			};
		} else {
			// Display the connect button
			document.querySelector('#connect-button').style.display = 'block';
		}

		// Initialize the Spotify Web Playback SDK with the access token
		function initializePlayer(token) {
			// Initialize the Spotify Web Playback SDK
			window.onSpotifyPlayerAPIReady = () => {
				console.log('Spotify Player API is ready');
				// Set up the Spotify Web Playback SDK with our credentials
				const player = new Spotify.Player({
					name: 'My Spotify Player',
					getOAuthToken: (cb) => {
						cb(token);
					}
				});
				// Connect to the player and start playback
				player.connect().then(success => {
					if (success) {
						console.log('The Web Playback SDK successfully connected to Spotify!');
						document.querySelector('#play-button').disabled = false;
						document.querySelector('#pause-button').disabled = false;
					}
				}).catch(error => {
					console.error(error);
				});
				// Listen for playback state changes
				player.addListener('player_state_changed', state => {
					console.log('Player state changed:', state);
				});
				// Set up the Play button
				document.querySelector('#play-button').addEventListener('click', () => {
					player.resume();
				});
				// Set up the Pause button
				document.querySelector('#pause-button').addEventListener('click', () => {
					player.pause();
				});
			};
		}

		// Connect to Spotify
		document.querySelector('#connect-button').addEventListener('click', () => {
			const url = `https://accounts.spotify.com/authorize?response_type=token&client_id=${CLIENT_ID}&redirect_uri=${encodeURIComponent(REDIRECT_URI)}&scope=${encodeURIComponent(SCOPES)}`;
			window.location.href = url;
		});
	</script>
</body>
</html>
