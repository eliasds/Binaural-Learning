<!DOCTYPE html>
<html>
<head>
	<title>Jamendo Web API Example</title>
	<script src="https://unpkg.com/tone"></script>
</head>
<body>
	<h1>Jamendo Web API Example V3</h1>

	<button onclick="authenticate()">Authenticate with Jamendo</button>
	<button onclick="fetchRandomSong()">Fetch Random Song</button>

	<script>
		const clientId = '69073f3b';
		const redirectUri = 'https://eliasds.github.io/Binaural-Learning/redirect.html';
		//const responseType = 'token';
		const responseType = 'code';
		const scope = 'basic';

		function authenticate() {
			const authUrl = `https://api.jamendo.com/v3.0/oauth/authorize?client_id=${clientId}&redirect_uri=${redirectUri}&response_type=${responseType}&scope=${scope}`;
			window.location.href = authUrl;
		}

	


		// Fetch a random song from Jamendo using JSONP
		function fetchRandomSong() {
			const apiUrl = `https://api.jamendo.com/v3.0/tracks/?format=json&limit=1&order=random&client_id=${clientId}&callback=${callbackFunctionName}`;

			// Create a new script element to make the JSONP request
			const script = document.createElement('script');
			script.src = apiUrl;
			document.head.appendChild(script);
		}

		// Callback function to handle the response
		function myCallback(response) {
			console.log(response);

			// Extract the song information from the response
			const song = response.results[0];
			const songUrl = song.audio;

			// Play the song using Tone.js and panner
			const player = new Tone.Player(songUrl).toDestination();
			const panner = new Tone.Panner(-1);
			player.connect(panner);
			player.start();
		}

		// Check if access token is present in the URL hash and save it in local storage
		const accessToken = window.location.hash.substr(1).split('&')[0].split('=')[1];
		if (accessToken) {
			localStorage.setItem('accessToken', accessToken);
		}
	</script>
</body>
</html>
